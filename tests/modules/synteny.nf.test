nextflow_process {

    name "Test Process SYNTENY"
    script "modules/synteny.nf"
    process "SYNTENY"

    test("Should run without failures") {

        when {
            params {
                // define parameters here:
                clean = false
            }
            process {
                """
                // define inputs of the process here. Example:
                //PLEASE NOTE: These files are too big to go in GitHub as they exceed total limit of storage in the repo so until Amazon S3 is set up this test can only be done locally
                Channel.of( ["Drosophila_santomea", file("${projectDir}/data/synteny_input/Drosophila_santomea.cds"), file("${projectDir}/data/synteny_input/Drosophila_santomea.bed"), "Drosophila_simulans", file("${projectDir}/data/synteny_input/Drosophila_simulans.cds"), file("${projectDir}/data/synteny_input/Drosophila_simulans.bed")] ).set{ in_channel }
                input[0] = in_channel
                """
            }
        }

        then {
            //check if test case succeeded
            assert process.success
            //analyze trace file (TODO: workout how this works with retry)
            assert process.trace.tasks().size() == 1
            with(process.out) {
              //checks one file exists in anchors channel
              assert anchors.size() == 1
              //checks one tuple exists in pdf channel
              assert pdf.size() == 1
              //check pdf tuple contains 3 elements
              assert pdf[0].size() == 3
              //checks one file exists in percsim channel
              assert percsim.size() == 1
              //checks one file exists in last channel
              assert last.size() == 1
              //checks output files aren't corrupted
              assert path(anchors[0]).md5 == '375298377779855bd3d2fc89847b60c0'
              assert path(percsim[0]).md5 == 'bf25abfbeef218a2b20d1988dada8865'
              assert path(last[0]).md5 == 'e4fc55949bcd1bfbd09d323e0109ac8d'
            }
        }

    }

}
